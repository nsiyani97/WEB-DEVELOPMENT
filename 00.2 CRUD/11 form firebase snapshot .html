<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase Snapshot CRUD</title>
  </head>
  <body>
    <h1>Firebase Snapshot CRUD</h1>
    <hr />

    <form id="userForm">
      <input type="text" id="name" placeholder="Name" required />
      <input type="tel" id="tel" placeholder="Tel" required />
      <input type="email" id="email" placeholder="Email" required />
      <button type="submit">Submit</button>
    </form>

    <br />

    <table border="1" cellpadding="5">
      <thead>
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Tel</th>
          <th>Email</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
      import { getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB4GW8B0OA9wzX4UAiBeLDa3w0eWGNFez8",
        authDomain: "my-first-project-bec63.firebaseapp.com",
        projectId: "my-first-project-bec63",
        storageBucket: "my-first-project-bec63.firebasestorage.app",
        messagingSenderId: "701356026896",
        appId: "1:701356026896:web:40ff4d86e2042525b4ee95",
        measurementId: "G-2QQL1EC1GZ",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const userRef = collection(db, "users");

      // DOM elements
      const tbody = document.getElementById("tbody");
      const form = document.getElementById("userForm");
      const nameInput = document.getElementById("name");
      const telInput = document.getElementById("tel");
      const emailInput = document.getElementById("email");

      let editId = null;

      // ðŸ”¥ REAL-TIME READ
      onSnapshot(userRef, (snapshot) => {
        tbody.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const id = docSnap.id;

          tbody.innerHTML += `
            <tr>
              <td>${id}</td>
              <td>${data.name}</td>
              <td>${data.tel}</td>
              <td>${data.email}</td>
              <td>
                <button onclick="editUser('${id}','${data.name}','${data.tel}','${data.email}')">Edit</button>
                <button onclick="deleteUser('${id}')">Delete</button>
              </td>
            </tr>
          `;
        });
      });

      // âž• CREATE & âœï¸ UPDATE
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const userData = {
          name: nameInput.value,
          tel: telInput.value,
          email: emailInput.value,
        };

        if (editId) {
          await updateDoc(doc(db, "users", editId), userData);
          editId = null;
        } else {
          await addDoc(userRef, userData);
        }

        form.reset();
      });

      // âœï¸ EDIT
      window.editUser = (id, name, tel, email) => {
        nameInput.value = name;
        telInput.value = tel;
        emailInput.value = email;
        editId = id;
      };

      // ðŸ—‘ï¸ DELETE
      window.deleteUser = async (id) => {
        await deleteDoc(doc(db, "users", id));
      };
    </script>
  </body>
</html>
